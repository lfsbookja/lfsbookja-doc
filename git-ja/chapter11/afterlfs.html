<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      11.5. LFS の次に向けて
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL-NS Stylesheets Vsnapshot" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-r12.0-315">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version r12.0-315
      </h4>
      <h3>
        第11章 作業終了
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="whatnow.html" title="さらなる情報">戻る</a>
          <p>
            さらなる情報
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../part5.html" title="付録">次へ</a>
          <p>
            付録
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter11.html" title="第11章 作業終了">上に戻る</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r12.0-315">ホーム</a>
        </li>
      </ul>
    </div>
    <h1 class="sect1">
      <a id="afterlfs" name="afterlfs"></a>11.5. LFS の次に向けて
    </h1>
    <div class="sect1" lang="ja" xml:lang="ja">
      <div class="sect2" lang="ja" xml:lang="ja">
        <h2 class="sect2">
          11.5.1. 次に何をやるのか
        </h2>
        <p>
          ここに LFS が完成して起動可能なシステムを手にしました。 ここから何をしますか？ 次はこれをどう使うかを決めることです。
          一般的には大きく２つの方法があります。 ワークステーションとするのかサーバーとするのかです。
          実のところ、両者は別々とする必要はありません。 それぞれにとって必要となるアプリケーションは、同じシステム内に含めることができます。
          もっとも以下では、それぞれを個別に見ていくことにします。
        </p>
        <p>
          サーバーとすることは比較的簡単です。 一般には <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/server/apache.html">
          Apache HTTP Server</a> のようなウェブサーバーと、<a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/server/mariadb.html">MariaDB</a>
          のようなデータベースサーバーから構成されます。 ただし他のサービスを含めても構いません。
          使い捨てデバイスに埋め込まれているオペレーティングシステムは、ここに分類されます。
        </p>
        <p>
          これに比べてワークステーションは、やや複雑です。 一般には <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/lxde/lxde.html">LXDE</a>,
          <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/xfce/xfce.html">XFCE</a>,
          <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/kde/kde.html">KDE</a>,
          <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/gnome/gnome.html">Gnome</a>
          といったグラフィカルユーザー環境が必要であり、これらは <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/x/installing.html">グラフィック環境</a>
          や <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/xsoft/firefox.html">
          Firefox ウェブブラウザー</a>, <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/xsoft/thunderbird.html">
          Thunderbird Email クライアント</a>, <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/xsoft/libreoffice.html">
          LibreOffice office スイート</a> といったグラフィックベースのアプリケーションによって成り立っています。
          こういったアプリケーションは、実に多くのパッケージ（所定機能の実現のために何百もの依存パッケージ）によるアプリケーションやライブラリを必要としています。
        </p>
        <p>
          上に加えて、全システム向けにシステムを管理するアプリケーション群があります。 そういったアプリケーションは BLFS
          ブックに掲載しています。 環境による話であって、そのアプリケーションをすべて必要とするものではありません。 例として
          <a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/basicnet/dhcpcd.html">
          dhcpcd</a> は、サーバーにおいては普通は不要のものですし、<a class="ulink" href=
          "https://www.linuxfromscratch.org/blfs/view/svn/basicnet/wireless_tools.html">wireless_tools</a>
          は、ラップトップシステムにのみ必要となるのが通常です。
        </p>
      </div>
      <div class="sect2" lang="ja" xml:lang="ja">
        <h2 class="sect2">
          11.5.2. 基本的な LFS 環境での作業
        </h2>
        <p>
          LFS を初めて起動すると、追加するパッケージをビルドするための内部ツールはすべて含まれています。
          ただしユーザー環境は十分なものではありません。 これを充足させていくには、いくつかの方法があります。
        </p>
        <div class="sect3">
          <h3 class="sect3">
            11.5.2.1. LFS ホストからの chroot による作業
          </h3>
          <p>
            この方法を使えば、完全なグラフィック環境を扱うことができ、充実したブラウザーを利用してコピー/ペースト機能が活用できます。
            またホスト内にある wget のようなアプリケーションを使うことができるため、パッケージソースをダウンロードして、chroot
            環境内で作業可能な場所に配置することができます。
          </p>
          <p>
            chroot 環境内で適切にパッケージビルドを行うためには、仮想ファイルシステムのマウントを忘れずに行っておく必要があります。
            これを実現する１つの方法として、以下のようなスクリプトを <span class=
            "bold"><strong>HOST</strong></span> システム内に生成して利用することです。
          </p>
          <pre class="screen"><span class=
          "command"><strong>cat &gt; ~/mount-virt.sh &lt;&lt; "EOF"
#!/bin/bash

function mountbind
{
   if ! mountpoint $LFS/$1 &gt;/dev/null; then
     $SUDO mount --bind /$1 $LFS/$1
     echo $LFS/$1 mounted
   else
     echo $LFS/$1 already mounted
   fi
}

function mounttype
{
   if ! mountpoint $LFS/$1 &gt;/dev/null; then
     $SUDO mount -t $2 $3 $4 $5 $LFS/$1
     echo $LFS/$1 mounted
   else
     echo $LFS/$1 already mounted
   fi
}

if [ $EUID -ne 0 ]; then
  SUDO=sudo
else
  SUDO=""
fi

if [ x$LFS == x ]; then
  echo "LFS not set"
  exit 1
fi

mountbind dev
mounttype dev/pts devpts devpts -o gid=5,mode=620
mounttype proc    proc   proc
mounttype sys     sysfs  sysfs
mounttype run     tmpfs  run
if [ -h $LFS/dev/shm ]; then
  install -v -d -m 1777 $LFS$(realpath /dev/shm)
else
  mounttype dev/shm tmpfs tmpfs -o nosuid,nodev
fi

#mountbind usr/src
#mountbind boot
#mountbind home
EOF</strong></span></pre>
          <p>
            なおこのスクリプト内の最後の３つのコマンドはコメントアウトしています。
            こういったディレクトリがホストシステム上の個別パーティションにマウントされていて、LFS/BLFS
            システムの起動時にマウントする必要がある場合に利用します。
          </p>
          <p>
            このスクリプトは、一般ユーザー（これを推奨）または <code class="systemitem">root</code>
            ユーザーにて <span class="command"><strong>bash
            ~/mount-virt.sh</strong></span> として実行します。
            一般ユーザーとして実行する場合には、ホストシステム上に sudo が必要です。
          </p>
          <p>
            もう一つ、このスクリプトにおいて指摘するポイントとして、ダウンロードしたパッケージファイルをどこに保存するのかという点があります。
            その場所については任意です。 たとえば一般ユーザーのホームディレクトリ配下の ~/sources
            といった場所にすることができます。 あるいはグローバルな場所として /usr/src とすることもできます。
            ここで推奨したいのは、（chroot 環境から見て）/sources といったディレクトリに、BLFS と LFS
            のソースを混ぜないようにすることです。 どのようにするにせよ、パッケージソースは chroot
            環境内部からアクセスできるようにしなければなりません。
          </p>
          <p>
            ここで紹介する機能の最後は、chroot 環境に入る手順を効率化することです。 これは、ホストシステム内のユーザー向け
            ~/.bashrc ファイルにエイリアスを設けることで実現します。
          </p>
          <pre class="screen"><span class=
          "command"><strong>alias lfs='sudo /usr/sbin/chroot /mnt/lfs /usr/bin/env -i HOME=/root TERM="$TERM" PS1="\u:\w\\\\$ "
PATH=/bin:/usr/bin:/sbin:/usr/sbin /bin/bash --login'</strong></span></pre>
          <p>
            このエイリアスは多少トリッキーなところがあります。 それはクォートと重複するバックスラッシュ文字があるところです。
            これらは単一行にすべて記述しなければなりません。 上で示したコマンド記述は、見やすさを考慮して二行に分けているに過ぎません。
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            11.5.2.2. ssh 経由のリモート作業
          </h3>
          <p>
            この方法はグラフィック環境下においても利用できます。 まず何よりも <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/postlfs/openssh.html">
            sshd</a> を LFS システムにインストールすることが必要です。 これは通常 chroot 環境にて行います。 また 2
            つめのコンピューターも必要です。 この方法は、複雑な chroot 環境を必要としないことから、単純であるという利点があります。
            追加導入するパッケージに対しても、LFS
            からビルドしたカーネルを用いていくことになるので、インストールパッケージに対しても完全なシステム構成を保証し続けることになります。
          </p>
          <p>
            LFS システム上においてビルドするソースパッケージを <span class=
            "command"><strong>scp</strong></span> コマンドによってアップロードすることができます。
            LFS システム上に直接ダウンロードするのであれば、chroot 環境内において <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/general/libtasn1.html">
            libtasn1</a>, <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/postlfs/p11-kit.html">
            p11-kit</a>, <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/postlfs/make-ca.html">
            make-ca</a>, <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/basicnet/wget.html">
            wget</a> をインストールしてください。 （あるいは LFS システムの起動後に、それらのソースを <span class=
            "command"><strong>scp</strong></span> を使ってアップロードしてください。）
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            11.5.2.3. LFS コマンドラインからの作業
          </h3>
          <p>
            この方法を用いるには chroot 環境において <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/general/libtasn1.html">
            libtasn1</a>, <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/postlfs/p11-kit.html">
            p11-kit</a>, <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/postlfs/make-ca.html">
            make-ca</a>, <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/basicnet/wget.html">
            wget</a>, <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/general/gpm.html">
            gpm</a>, <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/basicnet/links.html">
            links</a> (または <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/svn/basicnet/lynx.html">
            lynx</a>) をインストールしておき、再起動して新たな LFS システムに入ることが必要です。
            その時点において、システムにはデフォルトで 6 つの仮想コンソールが存在します。 コンソールの切り替えは簡単で、
            <span class="keycap"><strong>Alt</strong></span>+<span class=
            "keycap"><strong>Fx</strong></span> のキー組み合わせを利用します。 ここで
            <span class="keycap"><strong>Fx</strong></span> は <span class=
            "keycap"><strong>F1</strong></span> から <span class=
            "keycap"><strong>F6</strong></span> までのキーを表します。 別のキー組み合わせ
            <span class="keycap"><strong>Alt</strong></span>+<span class=
            "keycap"><strong>←</strong></span> と <span class=
            "keycap"><strong>Alt</strong></span>+<span class=
            "keycap"><strong>→</strong></span> を使ってコンソールを切り替えることもできます。
          </p>
          <p>
            この後に 2 つの異なる仮想コンソールにログインして、1 つのコンソール上では links または lynx
            ブラウザーを開き、もう 1 つのコンソールでは bash を起動します。 GPM
            があることで、ブラウザー上のコマンドを左マウスボタンによりコピーすることができます。
            したがってコンソールを移って、そのコマンドをペーストすることができます。
          </p>
          <div class="admon note">
            <img alt="[注記]" src="../images/note.png" />
            <h3>
              注記
            </h3>
            <p>
              注記にして示しておくと、X Windows インスタンスから仮想コンソールを切り替えるには、 <span class=
              "keycap"><strong>Ctrl</strong></span>+<span class=
              "keycap"><strong>Alt</strong></span>+<span class=
              "keycap"><strong>Fx</strong></span> のキー組み合わせを用います。
              ただしマウスによるコピー操作は、グラフィックインターフェースと仮想コンソール間では動作しません。 X Windows
              ディスプレイに戻るため <span class=
              "keycap"><strong>Ctrl</strong></span>+<span class=
              "keycap"><strong>Alt</strong></span>+<span class=
              "keycap"><strong>Fx</strong></span> の組み合わせを用いてください。 ここで
              <span class="keycap"><strong>Fx</strong></span> は一般的には
              <span class="keycap"><strong>F1</strong></span> ですが
              <span class="keycap"><strong>F7</strong></span> の場合もあります。
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="whatnow.html" title="さらなる情報">戻る</a>
          <p>
            さらなる情報
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../part5.html" title="付録">次へ</a>
          <p>
            付録
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter11.html" title="第11章 作業終了">上に戻る</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r12.0-315">ホーム</a>
        </li>
      </ul>
    </div>
  </body>
</html>
