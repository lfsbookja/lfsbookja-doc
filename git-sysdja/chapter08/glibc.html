<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      8.5. Glibc-2.42
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL-NS Stylesheets Vsnapshot" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-r12.4-47-systemd">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version r12.4-47-systemd
      </h4>
      <h3>
        第8章 基本的なソフトウェアのインストール
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="iana-etc.html" title=
          "Iana-Etc-20251120">戻る</a>
          <p>
            Iana-Etc-20251120
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="zlib.html" title="Zlib-1.3.1">次へ</a>
          <p>
            Zlib-1.3.1
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "第8章 基本的なソフトウェアのインストール">上に戻る</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r12.4-47-systemd">ホーム</a>
        </li>
      </ul>
    </div>
    <h1 class="sect1">
      <a id="ch-system-glibc" name="ch-system-glibc"></a>8.5. Glibc-2.42
    </h1>
    <div class="wrap" lang="ja" xml:lang="ja">
      <div class="package" lang="ja" xml:lang="ja">
        <p>
          Glibc パッケージは主要な C ライブラリを提供します。
          このライブラリは基本的な処理ルーチンを含むもので、メモリ割り当て、ディレクトリ走査、ファイルのオープン、クローズや入出力、文字列操作、パターンマッチング、算術処理、等々があります。
        </p>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">概算ビルド時間:</strong> <span class=
              "segbody">12 SBU</span>
            </div>
            <div class="seg">
              <strong class="segtitle">必要ディスク容量:</strong> <span class=
              "segbody">3.3 GB</span>
            </div>
          </div>
        </div>
      </div>
      <div class="installation" lang="ja" xml:lang="ja">
        <h2 class="sect2">
          8.5.1. Glibc のインストール
        </h2>
        <p>
          はじめにアップストリームによる変更を適用します。
        </p>
        <pre class="userinput"><kbd class=
        "command">patch -Np1 -i ../glibc-2.42-upstream_fixes-1.patch</kbd></pre>
        <p>
          Glibc のプログラムの中には <code class="filename">/var/db</code>
          ディレクトリに実行データを収容するものがあり、これは FHS に準拠していません。 以下のパッチを適用することで、実行データの収容先を
          FHS 準拠のディレクトリとします。
        </p>
        <pre class="userinput"><kbd class=
        "command">patch -Np1 -i ../glibc-2.42-fhs-1.patch</kbd></pre>
        <p>
          BLFS における Valgrind に不備を起こす問題を修正します。
        </p>
        <pre class="userinput"><kbd class=
        "command">sed -e '/unistd.h/i #include &lt;string.h&gt;' \
    -e '/libc_rwlock_init/c\
  __libc_rwlock_define_initialized (, reset_lock);\
  memcpy (&amp;lock, &amp;reset_lock, sizeof (lock));' \
    -i stdlib/abort.c </kbd></pre>
        <p>
          Glibc のドキュメントでは専用のビルドディレクトリを作成することが推奨されています。
        </p>
        <pre class="userinput"><kbd class="command">mkdir -v build
cd       build</kbd></pre>
        <p>
          <span class="command"><strong>ldconfig</strong></span> と
          <span class="command"><strong>sln</strong></span> ユーティリティーを
          <code class="filename">/usr/sbin</code> にインストールするようにします。
        </p>
        <pre class="userinput"><kbd class=
        "command">echo "rootsbindir=/usr/sbin" &gt; configparms</kbd></pre>
        <p>
          Glibc をコンパイルするための準備をします。
        </p>
        <pre class="userinput"><kbd class=
        "command">../configure --prefix=/usr                   \
             --disable-werror                \
             --disable-nscd                  \
             libc_cv_slibdir=/usr/lib        \
             --enable-stack-protector=strong \
             --enable-kernel=5.4</kbd></pre>
        <div class="variablelist">
          <p class="title">
            <strong>configure オプションの意味</strong>
          </p>
          <dl class="variablelist">
            <dt>
              <span class="term"><em class=
              "parameter"><code>--disable-werror</code></em></span>
            </dt>
            <dd>
              <p>
                GCC に対して -werror オプションを利用しないようにします。 テストスイートを実行するために必要となります。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--enable-kernel=5.4</code></em></span>
            </dt>
            <dd>
              <p>
                本オプションはビルドシステムに対して、カーネルバージョンが 5.4 のように古くても、 Glibc
                が利用されるように指示します。
                これより古いバージョンにおけるシステムコールが用いられないようにするため、その回避策をとるものです。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--enable-stack-protector=strong</code></em></span>
            </dt>
            <dd>
              <p>
                このオプション指定によりスタックに積まれる関数プリアンブル内に、追加のコードを付与することにより、システムセキュリティを向上させます。
                その追加コードは、スタック破壊攻撃（stack smashing
                attacks）のようなバッファーオーバーフローをチェックします。 なお Glibc
                に対して明示的に指定されたオプションは、常に GCC のデフォルトを上書きします。 したがってこのオプションは、GCC
                に対して <code class="option">--enable-default-ssp</code>
                の設定を行っているからこそ、ここでも指定が必要になります。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--disable-nscd</code></em></span>
            </dt>
            <dd>
              <p>
                nscd (name service cache daemon) は使われることがないのでビルドしないようにします。
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>libc_cv_slibdir=/usr/lib</code></em></span>
            </dt>
            <dd>
              <p>
                この変数によって、あらゆるシステムにおけるライブラリを正しく設定します。 lib64 は利用しません。
              </p>
            </dd>
          </dl>
        </div>
        <p>
          パッケージをコンパイルします。
        </p>
        <pre class="userinput"><kbd class="command">make</kbd></pre>
        <div class="admon important">
          <img alt="[重要]" src="../images/important.png" />
          <h3>
            重要
          </h3>
          <p>
            本節における Glibc のテストスイートは極めて重要なものです。 したがってどのような場合であっても必ず実行してください。
          </p>
        </div>
        <p>
          全般にテストの中には失敗するものがありますが、以下に示すものであれば無視しても構いません。
        </p>
        <pre class="userinput"><kbd class="command">make check</kbd></pre>
        <p>
          テストに失敗する場合があります。 これは Glibc のテストスイートがホストシステムにある程度依存しているためです。 6000
          を超えるテストの中で、ほんの少数のテストは失敗しますが、無視できるものです。 LFS
          の当バージョンにおいて発生しがちな問題を以下に示します。
        </p>
        <div class="itemizedlist">
          <ul>
            <li class="listitem">
              <p>
                <span class="emphasis"><em>io/tst-lchmod</em></span> は LFS の
                chroot 環境においては失敗します。
              </p>
            </li>
            <li class="listitem">
              <p>
                <span class=
                "emphasis"><em>nss/tst-nss-files-hosts-multi</em></span>、<span class="emphasis"><em>nptl/tst-thread-affinity*</em></span>
                のようなテストでは、タイムアウトを原因として
                (特に比較的処理性能の低いシステムの利用や平行ビルドを使ったテストスイート実行において) そのテストが失敗します。
                このようなテストは以下を実行すれば一覧として得られます。
              </p>
              <pre class="userinput"><kbd class=
              "command">grep "Timed out" $(find -name \*.out)</kbd></pre>
              <p>
                <span class="command"><strong>TIMEOUTFACTOR=<em class=
                "replaceable"><code>&lt;factor&gt;</code></em> make test
                t=<em class="replaceable"><code>&lt;test
                name&gt;</code></em></strong></span> というコマンド実行により、テスト 1
                つずつに対してタイムアウト時間を拡張して再実行することができます。 たとえば <span class=
                "command"><strong>TIMEOUTFACTOR=10 make test
                t=nss/tst-nss-files-hosts-multi</strong></span> とすれば
                <span class=
                "emphasis"><em>nss/tst-nss-files-hosts-multi</em></span>
                のテストが、元々のタイムアウトの 10 倍としながら再実行できます。
              </p>
            </li>
            <li class="listitem">
              <p>
                さらに CPU モデルが古い場合に (たとえば <span class=
                "emphasis"><em>elf/tst-cpu-features-cpuinfo</em></span>
                が)、またホストのカーネルバージョンが古い場合に (たとえば <span class=
                "emphasis"><em>stdlib/tst-arc4random-thread</em></span>
                が)、それぞれ失敗することがあります。
              </p>
            </li>
          </ul>
        </div>
        <p>
          支障が出る話ではありませんが Glibc のインストール時には <code class=
          "filename">/etc/ld.so.conf</code> ファイルが存在していないとして警告メッセージが出力されます。
          これをなくすために以下を実行します。
        </p>
        <pre class="userinput"><kbd class=
        "command">touch /etc/ld.so.conf</kbd></pre>
        <p>
          Makefile を修正して、古くなった健全性チェックをスキップするようにします。 これは、この段階での LFS
          環境では失敗するためです。
        </p>
        <pre class="userinput"><kbd class=
        "command">sed '/test-installation/s@$(PERL)@echo not running@' -i ../Makefile</kbd></pre>
        <div class="admon important">
          <img alt="[重要]" src="../images/important.png" />
          <h3>
            重要
          </h3>
          <p>
            稼働中の LFS システムにおいて Glibc のマイナーバージョンを最新のものにアップグレードする場合 (たとえば
            Glibc-2.36 を Glibc-2.42
            にあげる場合)、いくつか追加の措置を講じることで、システムが壊れないようにすることが必要です。
          </p>
          <div class="itemizedlist">
            <ul>
              <li class="listitem">
                <p>
                  11.0 未満の Glibc をアップグレードすることは LFS システムにおいてはサポートしていません。
                  そのような古い LFS システムにおいて最新の Glibc が必要になる場合は、LFS を再構築してください。
                </p>
              </li>
              <li class="listitem">
                <p>
                  12.0 未満の Glibc をアップグレードする場合は <a class="xref" href=
                  "libxcrypt.html" title=
                  "8.28. Libxcrypt-4.5.2">「Libxcrypt-4.5.2.」</a> に従って
                  <span class="application">Libxcrypt</span> をインストールしてください。
                  さらにその <span class="application">Libxcrypt</span>
                  の通常インストール手順に加えて、<span class="bold"><strong>Libxcrypt
                  の注記の節に示されている手順に従って <code class=
                  "filename">libcrypt.so.1*</code> のインストールを必ず行ってください
                  (それ以前に行っている Glibc のビルドにおいてインストールした <code class=
                  "filename">libcrypt.so.1</code>
                  を置き換えてください)。</strong></span>.
                </p>
              </li>
              <li class="listitem">
                <p>
                  12.1 未満の Glibc をアップグレードする場合は <span class=
                  "command"><strong>nscd</strong></span> プログラムを削除してください。
                </p>
                <pre class="userinput"><kbd class=
                "command">rm -f /usr/sbin/nscd</kbd></pre>
                <p>
                  (12.1 未満の) システムが Systemd に基づいている場合は、<span class=
                  "command"><strong>nscd</strong></span> サービスは停止させ無効化します。
                </p>
                <pre class="userinput"><kbd class=
                "command">systemctl disable --now nscd</kbd></pre>
              </li>
              <li class="listitem">
                <p>
                  (現時点のカーネルバージョンは <span class="command"><strong>uname
                  -r</strong></span> により確認することができますが) 5.4
                  よりも古いカーネルをアップグレードして再起動する場合には <a class="xref" href=
                  "../chapter10/kernel.html" title=
                  "10.3. Linux-6.17.9">「Linux-6.17.9」</a> の説明に従ってください。
                </p>
              </li>
              <li class="listitem">
                <p>
                  (現時点の API ヘッダーバージョンは <span class="command"><strong>cat
                  /usr/include/linux/version.h</strong></span>
                  により確認することができますが) 5.4 よりも古い API ヘッダーをアップグレードする場合は、<a class=
                  "xref" href="../chapter05/linux-headers.html" title=
                  "5.4. Linux-6.17.9 API ヘッダー">「Linux-6.17.9 API ヘッダー」</a>
                  の説明に従ってください (ただし <span class=
                  "command"><strong>cp</strong></span> コマンドからは <code class=
                  "envar">$LFS</code> を取り除いてください)。
                </p>
              </li>
              <li class="listitem">
                <p>
                  <code class="envar">DESTDIR</code> を利用したインストール方法により Glibc
                  の共有ライブラリをアップグレードする場合には、以下のように一つの <span class=
                  "command"><strong>install</strong></span> コマンドにより行ってください。
                </p>
                <pre class="userinput"><kbd class=
                "command">make DESTDIR=$PWD/dest install
install -vm755 dest/usr/lib/*.so.* /usr/lib</kbd></pre>
              </li>
            </ul>
          </div>
          <p>
            自分が何をしているのかを完全に理解できていないのであれば、この手順に忠実に従ってください。 <span class=
            "bold"><strong>不用意にこの手順を見逃して進めてしまうと、システムが完全に利用不能になりかねません。ここに警告しておきます。</strong></span>
          </p>
          <p>
            <span class="command"><strong>make install</strong></span>
            コマンド、<code class="filename">/usr/bin/ldd</code> に対する <span class=
            "command"><strong>sed</strong></span>
            コマンド、ロケールをインストールするコマンドを順に実行します。 ここまで行ったら即座にシステムを再起動してください。
          </p>
          <p>
            システムの再起動が成功したら次を行います。 今起動させている LFS システムが 12.0 よりも最新のものであって、GCC
            のビルド時に <em class=
            "parameter"><code>--disable-fixincludes</code></em>
            オプションをつけていなかった場合は、2 つの GCC ヘッダーファイルを適切な位置に移動させた上で Glibc
            ヘッダーファイルにおける<span class="quote">「<span class=
            "quote">fixed</span>」</span>を削除します。
          </p>
          <pre class="userinput"><kbd class=
          "command">DIR=$(dirname $(gcc -print-libgcc-file-name))
[ -e $DIR/include/limits.h ]    || mv $DIR/include{-fixed,}/limits.h
[ -e $DIR/include/syslimits.h ] || mv $DIR/include{-fixed,}/syslimits.h
rm -rfv $DIR/include-fixed/*
unset DIR</kbd></pre>
        </div>
        <p>
          パッケージをインストールします。
        </p>
        <pre class="userinput"><kbd class="command">make install</kbd></pre>
        <p>
          <span class="command"><strong>ldd</strong></span>
          スクリプト内にある実行可能なローダーへのパスがハードコーディングされているので、これを修正します。
        </p>
        <pre class="userinput"><kbd class=
        "command">sed '/RTLDLIST=/s@/usr@@g' -i /usr/bin/ldd</kbd></pre>
        <p>
          システムを各種の言語に対応させるためのロケールをインストールします。
          テストスイートにおいてロケールは必要ではありませんが、ロケールが不足していることによって、重要なテストが実施されずに見逃してしまうパッケージがあるかもしれません。
        </p>
        <p>
          各ロケールは <span class="command"><strong>localedef</strong></span>
          プログラムを使ってインストールします。 例えば以下に示す 2 つめの <span class=
          "command"><strong>localedef</strong></span>
          では、キャラクターセットには依存しないロケール定義 <code class=
          "filename">/usr/share/i18n/locales/cs_CZ</code> とキャラクターマップ定義
          <code class="filename">/usr/share/i18n/charmaps/UTF-8.gz</code>
          とを結合させて <code class=
          "filename">/usr/lib/locale/locale-archive</code> ファイルにその情報を付け加えます。
          以下のコマンドは、テストを成功させるために必要となる最低限のロケールをインストールするものです。
        </p>
        <pre class="userinput"><kbd class=
        "command">localedef -i C -f UTF-8 C.UTF-8
localedef -i cs_CZ -f UTF-8 cs_CZ.UTF-8
localedef -i de_DE -f ISO-8859-1 de_DE
localedef -i de_DE@euro -f ISO-8859-15 de_DE@euro
localedef -i de_DE -f UTF-8 de_DE.UTF-8
localedef -i el_GR -f ISO-8859-7 el_GR
localedef -i en_GB -f ISO-8859-1 en_GB
localedef -i en_GB -f UTF-8 en_GB.UTF-8
localedef -i en_HK -f ISO-8859-1 en_HK
localedef -i en_PH -f ISO-8859-1 en_PH
localedef -i en_US -f ISO-8859-1 en_US
localedef -i en_US -f UTF-8 en_US.UTF-8
localedef -i es_ES -f ISO-8859-15 es_ES@euro
localedef -i es_MX -f ISO-8859-1 es_MX
localedef -i fa_IR -f UTF-8 fa_IR
localedef -i fr_FR -f ISO-8859-1 fr_FR
localedef -i fr_FR@euro -f ISO-8859-15 fr_FR@euro
localedef -i fr_FR -f UTF-8 fr_FR.UTF-8
localedef -i is_IS -f ISO-8859-1 is_IS
localedef -i is_IS -f UTF-8 is_IS.UTF-8
localedef -i it_IT -f ISO-8859-1 it_IT
localedef -i it_IT -f ISO-8859-15 it_IT@euro
localedef -i it_IT -f UTF-8 it_IT.UTF-8
localedef -i ja_JP -f EUC-JP ja_JP
localedef -i ja_JP -f UTF-8 ja_JP.UTF-8
localedef -i nl_NL@euro -f ISO-8859-15 nl_NL@euro
localedef -i ru_RU -f KOI8-R ru_RU.KOI8-R
localedef -i ru_RU -f UTF-8 ru_RU.UTF-8
localedef -i se_NO -f UTF-8 se_NO.UTF-8
localedef -i ta_IN -f UTF-8 ta_IN.UTF-8
localedef -i tr_TR -f UTF-8 tr_TR.UTF-8
localedef -i zh_CN -f GB18030 zh_CN.GB18030
localedef -i zh_HK -f BIG5-HKSCS zh_HK.BIG5-HKSCS
localedef -i zh_TW -f UTF-8 zh_TW.UTF-8</kbd></pre>
        <p>
          上に加えて、あなたの国、言語、キャラクターセットを定めるためのロケールをインストールしてください。
        </p>
        <p>
          必要に応じて <code class=
          "filename">glibc-2.42/localedata/SUPPORTED</code>
          に示されるすべてのロケールを同時にインストールしてください。(そこには上のロケールも含め、すべてのロケールが列記されています。)
          以下のコマンドによりそれを実現します。 ただしこれには相当な処理時間を要します。
        </p>
        <pre class="userinput"><kbd class=
        "command">make localedata/install-locales</kbd></pre>
        <div class="admon note">
          <img alt="[注記]" src="../images/note.png" />
          <h3>
            注記
          </h3>
          <p>
            現状の Glibc は、国際ドメイン名の解決に libidn2 を利用します。 これは実行時に依存するパッケージです。
            この機能が必要である場合は、BLFS にある <a class="ulink" href=
            "https://www.linuxfromscratch.org/blfs/view/systemd/general/libidn2.html">
            libidn2</a> ページに示されているインストール手順を参照してください。
          </p>
        </div>
      </div>
      <div class="configuration" lang="ja" xml:lang="ja">
        <h2 class="sect2">
          <a id="conf-glibc" name="conf-glibc"></a>8.5.2. Glibc の設定
        </h2>
        <div class="sect3">
          <h3 class="sect3">
            8.5.2.1. nsswitch.conf の追加
          </h3>
          <p>
            <code class="filename">/etc/nsswitch.conf</code>
            ファイルを作成しておく必要があります。 このファイルが無い場合、Glibc のデフォルト値ではネットワーク環境下にて Glibc
            が正しく動作しません。
          </p>
          <p>
            以下のコマンドを実行して <code class="filename">/etc/nsswitch.conf</code>
            ファイルを生成します。
          </p>
          <pre class="userinput"><kbd class=
          "command">cat &gt; /etc/nsswitch.conf &lt;&lt; "EOF"
<code class="literal"># Begin /etc/nsswitch.conf

passwd: files systemd
group: files systemd
shadow: files systemd

hosts: mymachines resolve [!UNAVAIL=return] files myhostname dns
networks: files

protocols: files
services: files
ethers: files
rpc: files

# End /etc/nsswitch.conf</code>
EOF</kbd></pre>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            8.5.2.2. タイムゾーンデータの追加
          </h3>
          <p>
            以下によりタイムゾーンデータをインストールし設定します。
          </p>
          <pre class="userinput"><kbd class=
          "command">tar -xf ../../tzdata2025b.tar.gz

ZONEINFO=/usr/share/zoneinfo
mkdir -pv $ZONEINFO/{posix,right}

for tz in etcetera southamerica northamerica europe africa antarctica  \
          asia australasia backward; do
    zic -L /dev/null   -d $ZONEINFO       ${tz}
    zic -L /dev/null   -d $ZONEINFO/posix ${tz}
    zic -L leapseconds -d $ZONEINFO/right ${tz}
done

cp -v zone.tab zone1970.tab iso3166.tab $ZONEINFO
zic -d $ZONEINFO -p America/New_York
unset ZONEINFO tz</kbd></pre>
          <div class="variablelist">
            <p class="title">
              <strong>zic コマンドの意味</strong>
            </p>
            <dl class="variablelist">
              <dt>
                <span class="term"><em class="parameter"><code>zic -L
                /dev/null ...</code></em></span>
              </dt>
              <dd>
                <p>
                  うるう秒を含まない posix タイムゾーンデータを生成します。 これらは <code class=
                  "filename">zoneinfo</code> や <code class=
                  "filename">zoneinfo/posix</code> に収容するものとして適切なものです。
                  <code class="filename">zoneinfo</code> へは POSIX
                  準拠のタイムゾーンデータを含めることが必要であり、こうしておかないと数々のテストスイートにてエラーが発生してしまいます。
                  組み込みシステムなどでは容量の制約が厳しいため、タイムゾーンデータはあまり更新したくない場合があり、<code class="filename">posix</code>
                  ディレクトリを設けなければ 1.9 MB もの容量を節約できます。
                  ただしアプリケーションやテストスイートによっては、エラーが発生するかもしれません。
                </p>
              </dd>
              <dt>
                <span class="term"><em class="parameter"><code>zic -L
                leapseconds ...</code></em></span>
              </dt>
              <dd>
                <p>
                  うるう秒を含んだ正しいタイムゾーンデータを生成します。
                  組み込みシステムなどでは容量の制約が厳しいため、タイムゾーンデータはあまり更新したくない場合や、さほど気にかけない場合もあります。
                  <code class="filename">right</code> ディレクトリを省略することにすれば 1.9MB
                  の容量を節約することができます。
                </p>
              </dd>
              <dt>
                <span class="term"><em class="parameter"><code>zic ... -p
                ...</code></em></span>
              </dt>
              <dd>
                <p>
                  <code class="filename">posixrules</code> ファイルを生成します。 ここでは
                  New York を用います。 POSIX では、日中の保存時刻として US ルールに従うことを規程しているためです。
                </p>
              </dd>
            </dl>
          </div>
          <p>
            ローカルなタイムゾーンの設定を行う１つの方法として、ここでは以下のスクリプトを実行します。
          </p>
          <pre class="userinput"><kbd class="command">tzselect</kbd></pre>
          <p>
            地域情報を設定するためにいくつか尋ねられるのでそれに答えます。 このスクリプトはタイムゾーン名を表示します。(例えば
            <span class="emphasis"><em>America/Edmonton</em></span> などです。)
            <code class="filename">/usr/share/zoneinfo</code> ディレクトリにはさらに
            <span class="emphasis"><em>Canada/Eastern</em></span> や
            <span class="emphasis"><em>EST5EDT</em></span> のようなタイムゾーンもあります。
            これらはこのスクリプトでは認識されませんが、利用することは可能です。
          </p>
          <p>
            以下のコマンドにより <code class="filename">/etc/localtime</code>
            ファイルを生成します。
          </p>
          <pre class="userinput"><kbd class=
          "command">ln -sfv /usr/share/zoneinfo/<em class=
          "replaceable"><code>&lt;xxx&gt;</code></em> /etc/localtime</kbd></pre>
          <p>
            <em class="replaceable"><code>&lt;xxx&gt;</code></em>
            の部分は設定するタイムゾーンの名前 (例えば Canada/Eastern など) に置き換えてください。
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="conf-ld" name="conf-ld"></a>8.5.2.3. ダイナミックローダー の設定
          </h3>
          <p>
            ダイナミックリンカー (<code class="filename">/lib/ld-linux.so.2</code>)
            がダイナミックライブラリを検索するデフォルトのディレクトリが <code class=
            "filename">/usr/lib</code> ディレクトリです。
            各種プログラムが実行される際にはここから検索されたダイナミックライブラリがリンクされます。 もし <code class=
            "filename">/usr/lib</code> 以外のディレクトリにライブラリファイルがあるなら <code class=
            "filename">/etc/ld.so.conf</code>
            ファイルに記述を追加して、ダイナミックローダーがそれらを探し出せるようにしておくことが必要です。
            追加のライブラリが配置されるディレクトリとしては <code class=
            "filename">/usr/local/lib</code> ディレクトリと <code class=
            "filename">/opt/lib</code> ディレクトリという二つがよく利用されます。
            ダイナミックローダーの検索パスとして、それらのディレクトリを追加します。
          </p>
          <p>
            以下のコマンドを実行して <code class="filename">/etc/ld.so.conf</code>
            ファイルを新たに生成します。
          </p>
          <pre class="userinput"><kbd class=
          "command">cat &gt; /etc/ld.so.conf &lt;&lt; "EOF"
<code class="literal"># Begin /etc/ld.so.conf
/usr/local/lib
/opt/lib
</code>
EOF</kbd></pre>
          <p>
            必要がある場合には、ダイナミックローダーに対する設定として、他ディレクトリにて指定されるファイルをインクルードするようにもできます。
            通常は、そのファイル内の１行に、必要となるライブラリパスを記述します。
            このような設定を利用する場合には以下のようなコマンドを実行します。
          </p>
          <pre class="userinput"><kbd class=
          "command">cat &gt;&gt; /etc/ld.so.conf &lt;&lt; "EOF"
<code class="literal"># Add an include directory
include /etc/ld.so.conf.d/*.conf
</code>
EOF
mkdir -pv /etc/ld.so.conf.d</kbd></pre>
        </div>
      </div>
      <div class="content" lang="ja" xml:lang="ja">
        <h2 class="sect2">
          <a id="contents-glibc" name="contents-glibc"></a>8.5.3. Glibc の構成
        </h2>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">インストールプログラム:</strong> <span class=
              "segbody">gencat, getconf, getent, iconv, iconvconfig,
              ldconfig, ldd, lddlibc4, ld.so (ld-linux-x86-64.so.2 または
              ld-linux.so.2 へのリンク), locale, localedef, makedb, mtrace,
              pcprofiledump, pldd, sln, sotruss, sprof, tzselect, xtrace,
              zdump, zic</span>
            </div>
            <div class="seg">
              <strong class="segtitle">インストールライブラリ:</strong> <span class=
              "segbody">ld-linux-x86-64.so.2, ld-linux.so.2,
              libBrokenLocale.{a,so}, libanl.{a,so}, libc.{a,so},
              libc_nonshared.a, libc_malloc_debug.so, libdl.{a,so.2}, libg.a,
              libm.{a,so}, libmcheck.a, libmemusage.so, libmvec.{a,so},
              libnsl.so.1, libnss_compat.so, libnss_dns.so, libnss_files.so,
              libnss_hesiod.so, libpcprofile.so, libpthread.{a,so.0},
              libresolv.{a,so}, librt.{a,so.1}, libthread_db.so, and
              libutil.{a,so.1}</span>
            </div>
            <div class="seg">
              <strong class="segtitle">インストールディレクトリ:</strong> <span class=
              "segbody">/usr/include/arpa, /usr/include/bits,
              /usr/include/gnu, /usr/include/net, /usr/include/netash,
              /usr/include/netatalk, /usr/include/netax25,
              /usr/include/neteconet, /usr/include/netinet,
              /usr/include/netipx, /usr/include/netiucv,
              /usr/include/netpacket, /usr/include/netrom,
              /usr/include/netrose, /usr/include/nfs, /usr/include/protocols,
              /usr/include/rpc, /usr/include/sys, /usr/lib/audit,
              /usr/lib/gconv, /usr/lib/locale, /usr/libexec/getconf,
              /usr/share/i18n, /usr/share/zoneinfo, /var/lib/nss_db</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            概略説明
          </h3>
          <table border="0" class="variablelist">
            <colgroup>
              <col align="left" valign="top" />
              <col />
            </colgroup>
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="gencat" name="gencat"></a><span class=
                    "term"><span class=
                    "command"><strong>gencat</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    メッセージカタログを生成します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="getconf" name="getconf"></a><span class=
                    "term"><span class=
                    "command"><strong>getconf</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    ファイルシステムに固有の変数に設定された値を表示します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="getent" name="getent"></a><span class=
                    "term"><span class=
                    "command"><strong>getent</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    管理データベースから設定項目を取得します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="iconv" name="iconv"></a><span class=
                    "term"><span class=
                    "command"><strong>iconv</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    キャラクターセットを変換します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="iconvconfig" name="iconvconfig"></a><span class=
                    "term"><span class=
                    "command"><strong>iconvconfig</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    高速ロードができる <span class=
                    "command"><strong>iconv</strong></span>
                    モジュール設定ファイルを生成します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ldconfig" name="ldconfig"></a><span class=
                    "term"><span class=
                    "command"><strong>ldconfig</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    ダイナミックリンカーの実行時バインディングを設定します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ldd" name="ldd"></a><span class=
                    "term"><span class="command"><strong>ldd</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    指定したプログラムまたは共有ライブラリが必要としている共有ライブラリを表示します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="lddlibc4" name="lddlibc4"></a><span class=
                    "term"><span class=
                    "command"><strong>lddlibc4</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    オブジェクトファイルを使って <span class=
                    "command"><strong>ldd</strong></span> コマンドを補助します。 これは
                    x86_64 のような最新アーキテクチャーには存在しません。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="locale" name="locale"></a><span class=
                    "term"><span class=
                    "command"><strong>locale</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    現在のロケールに対するさまざまな情報を表示します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="localedef" name="localedef"></a><span class=
                    "term"><span class=
                    "command"><strong>localedef</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    ロケールの設定をコンパイルします。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="makedb" name="makedb"></a><span class=
                    "term"><span class=
                    "command"><strong>makedb</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    テキストを入力として単純なデータベースを生成します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="mtrace" name="mtrace"></a><span class=
                    "term"><span class=
                    "command"><strong>mtrace</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    メモリトレースファイル (memory trace file) を読み込んで解釈します。
                    そして可読可能な書式で出力します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="pcprofiledump" name=
                    "pcprofiledump"></a><span class="term"><span class=
                    "command"><strong>pcprofiledump</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    PC プロファイリングによって生成された情報をダンプします。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="pldd" name="pldd"></a><span class=
                    "term"><span class=
                    "command"><strong>pldd</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    稼動中のプロセスにて利用されている動的共有オブジェクト (dynamic shared objects)
                    を一覧出力します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="sln" name="sln"></a><span class=
                    "term"><span class="command"><strong>sln</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    スタティックなリンクを行う <span class=
                    "command"><strong>ln</strong></span> プログラム。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="sotruss" name="sotruss"></a><span class=
                    "term"><span class=
                    "command"><strong>sotruss</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    指定されたコマンドの共有ライブラリ内のプロシジャーコールをトレースします。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="sprof" name="sprof"></a><span class=
                    "term"><span class=
                    "command"><strong>sprof</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    共有オブジェクトのプロファイリングデータを読み込んで表示します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="tzselect" name="tzselect"></a><span class=
                    "term"><span class=
                    "command"><strong>tzselect</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    ユーザーに対してシステムの設置地域を問合せ、対応するタイムゾーンの記述を表示します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="xtrace" name="xtrace"></a><span class=
                    "term"><span class=
                    "command"><strong>xtrace</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    プログラム内にて現在実行されている関数を表示することで、そのプログラムの実行状況を追跡します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="zdump" name="zdump"></a><span class=
                    "term"><span class=
                    "command"><strong>zdump</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    タイムゾーンをダンプします。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="zic" name="zic"></a><span class=
                    "term"><span class="command"><strong>zic</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    タイムゾーンコンパイラー。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ld.so" name="ld.so"></a><span class=
                    "term"><code class="filename">ld-*.so</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    共有ライブラリのためのヘルパープログラム。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libBrokenLocale" name=
                    "libBrokenLocale"></a><span class="term"><code class=
                    "filename">libBrokenLocale</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    Glibc が内部で利用するもので、異常が発生しているプログラムを見つけ出します。(例えば Motif
                    アプリケーションなど) 詳しくは <code class=
                    "filename">glibc-2.42/locale/broken_cur_max.c</code>
                    に書かれたコメントを参照してください。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libanl" name="libanl"></a><span class=
                    "term"><code class="filename">libanl</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    関数を何も含まないダミーライブラリ。 かつては非同期の名前解決 (asynchronous name
                    lookup) ライブラリでしたが、今その関数は <code class=
                    "filename">libc</code> に含まれます。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libc" name="libc"></a><span class=
                    "term"><code class="filename">libc</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    主要な C ライブラリ。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libc_malloc_debug" name=
                    "libc_malloc_debug"></a><span class="term"><code class=
                    "filename">libc_malloc_debug</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    プリロード時のメモリ割り当てチェックをオンにします。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libdl" name="libdl"></a><span class=
                    "term"><code class="filename">libdl</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    何の関数も含まないダミーライブラリ。 以前はダイナミックリンクインターフェースライブラリでしたが、現在その関数は
                    <code class="filename">libc</code> に含まれるようになりました。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libg" name="libg"></a><span class=
                    "term"><code class="filename">libg</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    何の関数も含まないダミーのライブラリ。 かつては <span class=
                    "command"><strong>g++</strong></span>
                    のランタイムライブラリであったものです。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libm" name="libm"></a><span class=
                    "term"><code class="filename">libm</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    数学ライブラリ。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libmvec" name="libmvec"></a><span class=
                    "term"><code class="filename">libmvec</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    ベクトル数学ライブラリ。 <code class="filename">libm</code>
                    が用いられる際に必要となるためリンクされます。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libmcheck" name="libmcheck"></a><span class=
                    "term"><code class="filename">libmcheck</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    このライブラリにリンクした場合、メモリ割り当てのチェック機能を有効にします。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libmemusage" name="libmemusage"></a><span class=
                    "term"><code class="filename">libmemusage</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    <span class="command"><strong>memusage</strong></span>
                    コマンドが利用するもので、プログラムのメモリ使用に関する情報を収集します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libnsl" name="libnsl"></a><span class=
                    "term"><code class="filename">libnsl</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    ネットワークサービスライブラリ。 現在は非推奨。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libnss" name="libnss"></a><span class=
                    "term"><code class="filename">libnss_*</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    NSS (Name Service Switch) モジュール。
                    ホスト、ユーザー名、エイリアス、サービス、プロトコルなどの名前解決を行う関数を提供します。
                    <code class="filename">/etc/nsswitch.conf</code> での設定に従って
                    <code class="filename">libc</code> によりロードされます。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libpcprofile" name="libpcprofile"></a><span class=
                    "term"><code class="filename">libpcprofile</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    PC プロファイルにたいして実行モジュールをプリロードするために用いられます。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libpthread" name="libpthread"></a><span class=
                    "term"><code class="filename">libpthread</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    関数を全く含まないダミーのライブラリ。 かつては POSIX.1c Threads Extensions
                    によって規定されているインターフェースと、POSIX.1b Real-time Extensions
                    によって規定されるセマフォーインターフェースをほとんど含めた関数を提供していました。 現在その関数は
                    <code class="filename">libc</code> に含まれるようになりました。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libresolv" name="libresolv"></a><span class=
                    "term"><code class="filename">libresolv</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    インターネットドメインネームサーバーに対しての、パケットの生成、送信、解析を行う関数を提供します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="librt" name="librt"></a><span class=
                    "term"><code class="filename">librt</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    POSIX.1b リアルタイム拡張 (Realtime Extension)
                    にて既定されているインターフェースをほぼ網羅した関数を提供します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libthread_db" name="libthread_db"></a><span class=
                    "term"><code class="filename">libthread_db</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    マルチスレッドプログラム用のデバッガーを構築するための有用な関数を提供します。
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libutil" name="libutil"></a><span class=
                    "term"><code class="filename">libutil</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    何の関数も含まないダミーライブラリ。 以前は、 さまざまな Unix
                    ユーティリティーに用いられる<span class="quote">「<span class=
                    "quote">標準的な</span>」</span>関数のコードを含んでいました。 現在その関数は
                    <code class="filename">libc</code> に含まれるようになりました。
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="iana-etc.html" title=
          "Iana-Etc-20251120">戻る</a>
          <p>
            Iana-Etc-20251120
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="zlib.html" title="Zlib-1.3.1">次へ</a>
          <p>
            Zlib-1.3.1
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "第8章 基本的なソフトウェアのインストール">上に戻る</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r12.4-47-systemd">ホーム</a>
        </li>
      </ul>
    </div>
  </body>
</html>
